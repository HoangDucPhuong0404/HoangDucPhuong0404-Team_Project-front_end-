define(["jquery",'Magento_Ui/js/modal/modal','Magento_Ui/js/modal/alert',"mage/url","mage/storage",'mage/translate',"pageCache",'tabs','mage/mage',"!domReady"],function($,modal,alert,urlBuilder,storage,$t,$pageCache){"use strict";$.widget("mage.MagenestCustomer",{options:{page:'create_account',lifeTimeOTP:1,isDisableBtnSendOTP:true,disableButtonTime:30},_create:function(){var self=this,checkValid=true;var buttonSendOTPCode=$("#sendOTPCode"),buttonConfirmOtpMd=$('#confirmOtpMd'),buttonConfirmOtp=$('#confirmOtp');buttonSendOTPCode.click(function(){var data={"number_phone":$("#telephone").val()||$("#email_address").val(),"form_key":$.cookie('form_key'),"currentUrl":document.URL};if(($("#telephone").length>0&&$('#telephone').valid())||($("#email_address").length>0&&$("#email_address").valid())){$(".message-otp-code").removeClass('active').html('').hide();$("#message-otp-code-default").hide();self.sendAjaxRequest(urlBuilder.build('smsmarketing/customer/sendOTP'),data).done(function(response){$("#message-otp-code-default").hide();if(response.prism_exist){var modalOptions={type:'popup',responsive:true,innerScroll:true,title:$t('Reset Password'),buttons:false,modalClass:'prism-reset-password'};$('#resetpassword-block').modal(modalOptions).modal('openModal');$('.modal-header').hide();$('#customer-popup-register').modal('closeModal');$("#email_address_md").val(response.phone_number);$("#message-otp-code").addClass('active').show().html($t(response.data.message));}else if(response.phone_exist){var forgotPasswordUrl=urlBuilder.build('customer/account/forgotpassword');$('.message-otp-code').addClass('active').show().html("<a href='"+forgotPasswordUrl+"'>"+$t('Telephone number already exists, please go to forgot password page to create new password')+"</a>");}else{$("#message-otp-code-default").hide();$(".message-otp-code").addClass('active').show().html($t(response.data.message));if(response.success){$('.message-expired').hide();$('.message-invalid').show();self.countLifeTimeOTPCode(self.options.lifeTimeOTP);if(Boolean(parseInt(self.options.isDisableBtnSendOTP))){self.enableButtonSendOTP(self.options.disableButtonTime);}}}});}});buttonConfirmOtp.click(function(){var data={telephone:$("#telephone").val(),otp:$("#otp_code").val(),form_key:$.cookie('form_key')},valid=$('#telephone').valid()&&$('#otp_code').valid();if(valid){self.sendAjaxRequest(urlBuilder.build('smsmarketing/customer/confirmOtp'),data).done(function(response){var message=response.message||'',customerData=response.customer_data||{};if(message){$('#confirm-otp-message').show().find('#confirm-otp-message-content').html($t(message));}else{$('#confirm-otp-message').hide();}
if(customerData&&customerData.dob){var dob=customerData.dob,day=dob.day,month=dob.month,year=dob.year;if(day){$('#sDay').val(day).attr('disabled',true);}
if(month){$('#sMonth').val(month).attr('disabled',true);}
if(year){$('#sYear').val(year).attr('disabled',true);}}})}});buttonConfirmOtpMd.click(function(){var data={telephone:$("#email_address_md").val(),otp:$("#otp_code_md").val(),form_key:$.cookie('form_key')},valid=$('#email_address_md').valid()&&$('#otp_code_md').valid();if(valid){self.sendAjaxRequest(urlBuilder.build('smsmarketing/customer/confirmOtp'),data).done(function(response){var message=response.message||'';if(message){$('#confirm-otp-message-md').show().find('#confirm-otp-message-content-md').html($t(message));}else{$('#confirm-otp-message').hide();}
if(response.valid===true){$("#message-otp-code, .note-message, #field-phone-modal, #message-invalid, #opt-code-required").hide();$("#message-otp-code").removeClass('active');$("#password-required, #password-confirm-required, #button-modal-contain").show();}
$('#resetpassword-block').on('modalclosed',function(){$("#message-otp-code, .note-message, #field-phone-modal, #message-invalid, #opt-code-required").show();$("#message-otp-code").addClass('active');$("#password-required, #password-confirm-required, #button-modal-contain").hide();});})}});this._bind();},_bind:function(){},enableButtonSendOTP:function(disableButtonTime){var resendTimeSendOTP=disableButtonTime;$('#sendOTPCode').attr('disabled',true);$('#sendOTPCode').text($t('Resend')+'('+resendTimeSendOTP+'s)');var interval=setInterval(function(){var seconds=parseInt(resendTimeSendOTP,10);--seconds;seconds=(seconds<0)?59:seconds;seconds=(seconds<10)?'0'+seconds:seconds;resendTimeSendOTP=seconds;$('#sendOTPCode').html($t('Resend')+'('+resendTimeSendOTP+'s)');if(seconds==0){clearInterval(interval);$('#sendOTPCode').removeAttr('disabled');$("#sendOTPCode").text($t('Send OTP Code'));}},1000);$("#sendOTPCode").click(function(){clearInterval(interval);})},countLifeTimeOTPCode:function(lifeTimeOTP){var timeFirst=lifeTimeOTP+":01";var interval=setInterval(function(){var timer=timeFirst.split(':');var minutes=parseInt(timer[0],10);var seconds=parseInt(timer[1],10);--seconds;minutes=(seconds<0)?--minutes:minutes;seconds=(seconds<0)?59:seconds;seconds=(seconds<10)?'0'+seconds:seconds;$('.life-time-otp').html(minutes+':'+seconds);timeFirst=minutes+':'+seconds;if(minutes<0){clearInterval(interval);$('.message-expired').show();$('.message-invalid').hide()}},1000);$("#sendOTPCode").click(function(){clearInterval(interval);})},sendAjaxRequest:function(url,data){return $.ajax({url:url,async:true,type:'post',data:data,dataType:'json',showLoader:true})},});return $.mage.MagenestCustomer;});